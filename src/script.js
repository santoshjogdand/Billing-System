let CustomerData = [
  {
    id: 1,
    first_name: "Casper",
    last_name: "Clemenceau",
    address: "82 Rutledge Trail",
    ph_no: "+91 750 478 7887",
    gstin: "32YZTOB1246Q7T1",
  },
  {
    id: 2,
    first_name: "Mabelle",
    last_name: "MacCaffrey",
    address: "9 Texas Crossing",
    ph_no: "+91 589 916 3656",
    gstin: "13DJVXD5845W6P8",
  },
  {
    id: 3,
    first_name: "Garfield",
    last_name: "Confait",
    address: "27 Pond Center",
    ph_no: "+91 976 652 4886",
    gstin: "67LHWHE6166U1A4",
  },
  {
    id: 4,
    first_name: "Abelard",
    last_name: "Roskelly",
    address: "23 Chive Crossing",
    ph_no: "+91 790 825 1940",
    gstin: "56FMNSV6073C0F4",
  },
  {
    id: 5,
    first_name: "Falkner",
    last_name: "Padson",
    address: "62793 Glacier Hill Parkway",
    ph_no: "+91 038 251 5974",
    gstin: "50NLDGA1836T7M6",
  },
  {
    id: 6,
    first_name: "Teressa",
    last_name: "Franzke",
    address: "27 2nd Lane",
    ph_no: "+91 024 437 1131",
    gstin: "30YPAUC9661R7F4",
  },
  {
    id: 7,
    first_name: "Goldie",
    last_name: "Douberday",
    address: "06170 Transport Way",
    ph_no: "+91 660 776 9687",
    gstin: "34BDEJQ2737Y5W9",
  },
  {
    id: 8,
    first_name: "Avictor",
    last_name: "Aiston",
    address: "529 Crest Line Center",
    ph_no: "+91 038 950 7677",
    gstin: "16JMGUT2242W7E9",
  },
  {
    id: 9,
    first_name: "Keenan",
    last_name: "Domotor",
    address: "5 Armistice Junction",
    ph_no: "+91 905 453 2548",
    gstin: "10FIBTN9146W5J7",
  },
  {
    id: 10,
    first_name: "Vasily",
    last_name: "Grishmanov",
    address: "77 Victoria Alley",
    ph_no: "+91 131 656 2474",
    gstin: "43LAUKD1272K9G8",
  },
  {
    id: 11,
    first_name: "Sissy",
    last_name: "Josefer",
    address: "14 Nobel Avenue",
    ph_no: "+91 096 622 8855",
    gstin: "17EPNLZ2540T0L3",
  },
  {
    id: 12,
    first_name: "Amalia",
    last_name: "Montrose",
    address: "2 Carberry Crossing",
    ph_no: "+91 934 387 2858",
    gstin: "77ZFUSU8832Y3S8",
  },
  {
    id: 13,
    first_name: "Gualterio",
    last_name: "Farrall",
    address: "3244 Barby Trail",
    ph_no: "+91 658 131 9880",
    gstin: "26MWNON6307X2M6",
  },
  {
    id: 14,
    first_name: "Justus",
    last_name: "Strangeways",
    address: "6768 Alpine Place",
    ph_no: "+91 411 775 5460",
    gstin: "12NSPQX1896U0N5",
  },
  {
    id: 15,
    first_name: "Antoinette",
    last_name: "Demicoli",
    address: "53 Sherman Avenue",
    ph_no: "+91 079 067 7228",
    gstin: "91LUJXR0305L9S0",
  },
  {
    id: 16,
    first_name: "Janaya",
    last_name: "Snoxall",
    address: "243 Grasskamp Way",
    ph_no: "+91 438 800 7871",
    gstin: "99XMCUZ0418R4H7",
  },
  {
    id: 17,
    first_name: "Nelly",
    last_name: "Kenningham",
    address: "425 Goodland Court",
    ph_no: "+91 850 962 0329",
    gstin: "45NNGKQ0494C0H2",
  },
  {
    id: 18,
    first_name: "Arlee",
    last_name: "Greenfield",
    address: "50268 Sachtjen Road",
    ph_no: "+91 892 625 3691",
    gstin: "74XYILG7381N6J3",
  },
  {
    id: 19,
    first_name: "Ced",
    last_name: "Malkin",
    address: "42703 Spaight Hill",
    ph_no: "+91 407 615 3590",
    gstin: "50HTZAD3441Y4P7",
  },
  {
    id: 20,
    first_name: "Arnuad",
    last_name: "Bugdell",
    address: "35 Namekagon Park",
    ph_no: "+91 429 608 9926",
    gstin: "78LFWYE7204L3Q8",
  },
];

let productsData = [
  {
    hsn: "21-62-44-13",
    product: "Quaker State coolant",
    qty: "1 kg",
    rate: 3.95,
  },
  { hsn: "12-60-80-14", product: "Shell grease", qty: "1 liter", rate: 66.75 },
  {
    hsn: "60-20-08-38",
    product: "Castrol engine oil",
    qty: "1 kg",
    rate: 97.03,
  },
  { hsn: "22-16-51-71", product: "Shell grease", qty: "1 kg", rate: 1.05 },
  {
    hsn: "80-05-73-14",
    product: "Pennzoil gear oil",
    qty: "1 kg",
    rate: 49.24,
  },
  { hsn: "33-37-36-21", product: "Shell grease", qty: "1 kg", rate: 2.74 },
  {
    hsn: "14-92-58-52",
    product: "Quaker State coolant",
    qty: "1 kg",
    rate: 48.86,
  },
  {
    hsn: "35-28-01-22",
    product: "Mobil 1 transmission oil",
    qty: "1 liter",
    rate: 77.65,
  },
  {
    hsn: "71-58-48-01",
    product: "Valvoline hydraulic oil",
    qty: "1 kg",
    rate: 77.08,
  },
  {
    hsn: "24-50-26-95",
    product: "Castrol engine oil",
    qty: "1 liter",
    rate: 22.74,
  },
  { hsn: "53-38-91-52", product: "Shell grease", qty: "1 liter", rate: 39.99 },
  {
    hsn: "55-33-08-03",
    product: "Pennzoil gear oil",
    qty: "1 liter",
    rate: 34.57,
  },
  {
    hsn: "18-73-63-59",
    product: "Castrol engine oil",
    qty: "500 ml",
    rate: 29.87,
  },
  {
    hsn: "51-25-56-20",
    product: "Mobil 1 transmission oil",
    qty: "1 kg",
    rate: 43.11,
  },
  { hsn: "67-62-98-77", product: "Shell grease", qty: "1 kg", rate: 28.61 },
  {
    hsn: "57-01-98-52",
    product: "Quaker State coolant",
    qty: "500 ml",
    rate: 58.73,
  },
  { hsn: "81-93-32-44", product: "Shell grease", qty: "1 kg", rate: 49.17 },
  { hsn: "14-43-48-89", product: "Pennzoil gear oil", qty: "1 kg", rate: 64.2 },
  {
    hsn: "12-02-15-97",
    product: "Quaker State coolant",
    qty: "1 kg",
    rate: 74.98,
  },
  {
    hsn: "58-63-41-77",
    product: "Castrol engine oil",
    qty: "1 liter",
    rate: 99.16,
  },
];

let CustomerInfoEle = document.getElementById("info");
let CustomerNameEle = document.getElementById("CustomerName");
let DateEle = document.getElementById("Date");
let selectedCustomer = new Object();
let billInputEle = document.querySelector(".billInput");
let currenProductNo = 1;
let SelectedProducts = new Array();
let nofSelectedProducts = 0;
let pruductclassval = new Array();

setCustomerInfo();
setProductInfo();

function setCustomerInfo() {
  const array = Array.from(CustomerInfoEle.children);
  for (let i = 0; i < 20; i++) {
    let val = CustomerData[i].first_name + " " + CustomerData[i].last_name;
    let childOption = document.createElement("option");
    childOption.setAttribute("value", val);
    childOption.setAttribute("class", "text-gray-900 text-sm");
    childOption.textContent = val;
    array[3].appendChild(childOption);
    array[6].textContent = "Phone Number";
  }
}
CustomerNameEle.addEventListener("change", () => {
  setMobileNumberOfCustomer(CustomerNameEle.value);
});
function setMobileNumberOfCustomer(CustomerName) {
  const array = Array.from(CustomerInfoEle.children);
  for (let i = 0; i < 20; i++) {
    let val = CustomerData[i].first_name + " " + CustomerData[i].last_name;
    if (CustomerName == val) {
      array[6].textContent = CustomerData[i].ph_no;
      array[6].disabled = true;
      selectedCustomer = CustomerData[i];
      // console.log(selectedCustomer)
    }
  }
}
setDate();
function setDate() {
  const today = new Date();
  const day = String(today.getDate()).padStart(2, "0");
  const month = String(today.getMonth() + 1).padStart(2, "0"); // January is 0
  const year = today.getFullYear();

  DateEle.textContent = `${day}-${month}-${year}`;
}

function AddNewProduct() {
  currenProductNo++;
  let newEleInner = `<label>Sr No.</label>
                <input class="md:m-0 md:w-[50px] mb-2 mt-2 h-8 text-black bg-white md:px-3 px-3" type="text" field="srNo" placeholder="${currenProductNo}" disabled>
                
                <label >Product</label>
                <select field="Product" class="productClass md:m-0 md:w-50 mb-2 mt-2 h-8 text-black bg-white px-4 " onchange="getSelectedProduct(${currenProductNo})" placeholder="Product">
                  <option selected>Select Product</option>
                </select>         

                <label >Qty</label>
                <input type="number" field="Qty" class="qtyClass outline-none md:m-0 md:w-24 mb-2 mt-2 h-8 text-black bg-white px-4 " oninput="fillTotals()" placeholder="Quantity" >      

                <label >Rate</label>
                <input type="number" field="Rate" class="rateClass md:m-0 md:w-24 mb-2 mt-2 h-8 text-black bg-white px-4 "  placeholder="0" disabled>

                <label>Total</label>
                <input type="number" field="Total" class="totalClass md:m-0 md:w-[8rem] mb-2 mt-2 h-8 text-black bg-white px-4"  placeholder="Total" disabled >
`;

  let BillInputClass = document.querySelector(".billInput");
  let ProductInfoELE = document.createElement("div");
  ProductInfoELE.setAttribute("id", "ProductInfo");
  ProductInfoELE.setAttribute(
    "class",
    "flex md:flex-row flex-col font-semibold justify-between md:items-center md:w-[99%] w-[90%] h-auto bg-blue-500 md:p-4 p-10 my-3 shadow-[rgba(50,50,93,0.25)_0px_6px_12px_-2px,_rgba(0,0,0,0.3)_0px_3px_7px_-3px]"
  );
  ProductInfoELE.setAttribute("productNo", currenProductNo);
  ProductInfoELE.innerHTML = newEleInner;
  // console.log(ProductInfoELE)
  BillInputClass.appendChild(ProductInfoELE);
  setProductInfo();
}
function removeLastProduct() {
  let BillInputClass = document.querySelector(".billInput");
  let array = Array.from(BillInputClass.children);
  // console.log(array,currenProductNo)
  // console.log(array[1])

  for (let i = 0; i < array.length; i++) {
    // console.log(array[i].getAttribute("productno"))
    if (array[i].getAttribute("productno") == currenProductNo) {
      array[i].remove();
      currenProductNo--;
      SelectedProducts[--nofSelectedProducts];
    }
  }
}

function setProductInfo() {
  let productClassEle = document.querySelectorAll(".productClass");
  productClassEle.forEach((productClass) => {
    for (let i = 0; i < 20; i++) {
      let ProductOptionsEle = document.createElement("option");
      ProductOptionsEle.value =
        productsData[i].product + " " + productsData[i].qty;
      ProductOptionsEle.textContent =
        productsData[i].product + " " + productsData[i].qty;
      productClass.appendChild(ProductOptionsEle);
    }
  });
}

function getSelectedProduct(num) {
  let SelectedProduct = "";
  let rate = "";
  let array = document.querySelectorAll(".productClass");
  // console.log(array,num)
  SelectedProduct = array[num - 1].value;
  // console.log(SelectedProduct)
  let array2 = Array.from(array[num - 1].parentElement.children);
  // console.log(array2)
  rate = array2[7].value = getProductRate(SelectedProduct);
  // console.log(SelectedProducts)
  fillTotals();
}
function getProductRate(ProductName) {
  let rate;
  for (let i = 0; i < 20; i++) {
    let fetched = productsData[i].product + " " + productsData[i].qty;
    if (ProductName == fetched) {
      rate = productsData[i].rate;
    }
  }

  return rate;
}
function gethsn(name) {
  for (let i = 0; i <= 20; i++) {
    try {
      if (name == productsData[i].product + " " + productsData[i].qty) {
        return productsData[i].hsn;
      }
    } catch (error) {
      continue;
    }
  }
}

function getValues() {
  pruductclassval = [];
  let productClassEleVal = document.querySelectorAll(".productClass");
  let productClassrate = document.querySelectorAll(".rateClass");
  let productClassqty = document.querySelectorAll(".qtyClass");
  let TotalClassqty = document.querySelectorAll(".totalClass");

  let grandTotal = 0;
  let total = 0;
  for (let i = 0; i < productClassEleVal.length; i++) {
    if (!(productClassEleVal[i].value == "Select Product")) {
      let t = productClassrate[i].value * productClassqty[i].value;
      let hsn = gethsn(productClassEleVal[i].value);
      pruductclassval.push({
        pname: productClassEleVal[i].value,
        phsn: hsn,
        prate: productClassrate[i].value,
        pqty: productClassqty[i].value,
        Total: t,
      });
      total += productClassrate[i].value * productClassqty[i].value;
      TotalClassqty[i].value = t.toFixed(3);
    } else {
      continue;
    }
  }
  let gst = total * (9 / 100);
  let round = Math.round(gst * 2 + total);
  let roundOff = round - (gst * 2 + total);
  grandTotal = gst * 2 + total + roundOff;

  pruductclassval.push({
    SubTotal: total.toFixed(3),
    gst: gst.toFixed(3),
    roundOff: roundOff.toFixed(3),
    GrandTotal: grandTotal.toFixed(3),
  });
}

function fillTotals() {
  getValues();
  let FinalValueElements = document.querySelectorAll(".FinalValueElements");
  FinalValueElements[0].innerHTML = `<b>${
    pruductclassval[pruductclassval.length - 1].SubTotal
  }</b>`;
  FinalValueElements[1].innerHTML = `<b>${
    pruductclassval[pruductclassval.length - 1].gst
  }</b>`;
  FinalValueElements[2].innerHTML = `<b>${
    pruductclassval[pruductclassval.length - 1].gst
  }</b>`;
  FinalValueElements[3].innerHTML = `<b>${
    pruductclassval[pruductclassval.length - 1].roundOff
  }</b>`;
  FinalValueElements[4].innerHTML = `<b>${
    pruductclassval[pruductclassval.length - 1].GrandTotal
  }</b>`;

  // FinalValueElements[0].innerHTML = `<b>${pruductclassval[0].SubTotal}</b>`
  // console.log(FinalValueElements)
}

function printBill() {
  try {
    getValues();
    pruductclassval.push(document.getElementById("invoice_no").value);
    // console.log(pruductclassval)
    console.log(selectedCustomer);
    localStorage.setItem("ProductValues", JSON.stringify(pruductclassval));
    localStorage.setItem("CustomerValues", JSON.stringify(selectedCustomer));
    // localStorage.setItem('CustomerValues', JSON.stringify(selectedCustomer));
    console.log("Data stored in Local Storage");
    window.location.href = "bill2.html";
  } catch (error) {
    alert("Something is missing!");
  }
}

function ShowTotals() {
  let fv = document.getElementById("FinalValues");
  let body = document.getElementById("bodyele");
  let main = document.getElementById("main");
  fv.classList.toggle("bottom-0");
  // fv.classList.toggle("md:bottom-[30%]");
  fv.classList.toggle("bottom-[-100%]");
  body.classList.toggle("overflow-hidden");
  main.classList.toggle("overflow-hidden");
  main.addEventListener('click',()=>{
    ShowTotals()
  })
}

function refresh() {
  location.reload();
}
